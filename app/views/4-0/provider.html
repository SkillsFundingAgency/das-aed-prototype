{% extends "layout.html" %}
{% set serviceName = "Find apprenticeship training" %}

<!-- Provider selected -->
{% set _selectedProvider = {} %}
{% for _provider in myData["providers-new"].list %}
    {% if myData.provider == _provider.id %}
        {% set _selectedProvider = _provider %}
    {% endif %}
{% endfor %}
{% set _providerTitle = _selectedProvider.name %}

<!-- Standard selected -->
{% set _selectedStandard = {} %}
{% for _standard in myData.standards.list %}
    {% if myData.standard == _standard.larsCode %}
        {% set _selectedStandard = _standard %}
    {% endif %}
{% endfor %}
{% set _standardTitle = _selectedStandard.title + " (level&nbsp;" + _selectedStandard.level + ")" %}

<!-- Location search -->
{% set _citiesAutocompleteList = myData.citiesAutocompleteList %}
{% set _defaultLocationSearchvalue = "" %}
{% if myData.locationapplied == true %}
    {% set _defaultLocationSearchvalue = myData.location %}
{% endif %}

{% block beforeContent %}
    {% include "includes/alpha-banner.html" %}
    {% include "includes/breadcrumb.html" %}
{% endblock %}

{% block content %}

<style>
    .fat-panel {
        /* border: 1px solid #b1b4b6; */
        padding: 20px 20px 1px 20px;
        margin-bottom: 30px;
        background: #f3f2f1;
    }
    #search-location {
        height: 40px;
        border-right: 0;
    }
    .autocomplete__hint {
        height: 40px;
    }
</style>

<div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">

        <!-- {% for name, item in _selectedProvider %}
        <p class="govuk-body" ><span class="govuk-!-font-weight-bold">{{ name }}</span>: {{ item | dump }}</p>
        {% endfor %} -->

        <span class="govuk-caption-xl">Training provider</span>
        <h1 class="govuk-heading-xl govuk-!-margin-bottom-6" >
            {{_providerTitle | safe}} 
        </h1>

        <p class="govuk-body govuk-!-margin-bottom-8">
            <span class="govuk-!-margin-bottom-2" style="display: inline-block;">Ofsted rating: </span>
            {% if _selectedProvider.ofsted == 0 %}
            <strong class="govuk-tag govuk-tag--grey">Not yet rated</strong>
            {% elif _selectedProvider.ofsted == 1 %}
            <strong class="govuk-tag govuk-tag--turquoise">Outstanding</strong>
            {% elif _selectedProvider.ofsted == 2 %}
            <strong class="govuk-tag govuk-tag--green govuk-!-font-size">Good</strong>
            {% elif _selectedProvider.ofsted == 3 %}
            <strong class="govuk-tag govuk-tag--yellow">Requires improvement</strong>
            {% elif _selectedProvider.ofsted == 4 %}
            <strong class="govuk-tag govuk-tag--red">Inadequate</strong>
            {% endif %} 
        </p>

        <div class="fat-panel">
            <h2 class="govuk-heading-l govuk-!-margin-bottom-2">{{_standardTitle | safe}}</h2>
            <p class="govuk-body govuk-!-margin-bottom-1">Achievement rate: <span class="govuk-!-font-weight-bol">68%</span> / National average: 64%</p>

            <h2 class="govuk-heading-m govuk-!-margin-bottom-2 govuk-!-margin-top-4">Availability{% if myData.locationapplied %} in {{myData.location}}{% endif %}</h2>

            {% if myData.locationapplied %}
            <p class="govuk-body">
                {% if _selectedProvider.locationmatch %}
                <strong class="govuk-tag govuk-tag--green">Available</strong>
                {% else %}
                <strong class="govuk-tag govuk-tag--red">Unavailable</strong>
                {% endif %}
            </p>
            {% if _selectedProvider.locationmatch == false %}
            <p class="govuk-body govuk-!-margin-bottom-2">{{_providerTitle | safe}} doesn't offer training for this course in {{myData.location}}.</p>
            {% endif %}
            <p class="govuk-body"><a href="provider?standard={{_selectedStandardlarsCode}}&provider={{_selectedProvider.id}}" class="govuk-link govuk-link--no-visited-state">Clear location</a></p>
            <!-- <p class="govuk-body"><a href="providers?standard={{_selectedStandardlarsCode}}&location={{_defaultLocationSearchvalue}}" class="govuk-link govuk-link--no-visited-state">View other providers</a></p> -->

            {% if _selectedProvider.locationmatch %}
            <h2 class="govuk-heading-m govuk-!-margin-bottom-2">Contact training provider</h2>
            <dl class="govuk-summary-list">
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">Email</dt>
                    <dd class="govuk-summary-list__value"><a class="govuk-link govuk-link--no-visited-state" href="#">contact@{{_providerTitle|lower|replace(" ", "")|replace(".", "")}}.co.uk</a></dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">Telephone</dt>
                    <dd class="govuk-summary-list__value">078&nbsp;7856&nbsp;9856</dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">Website</dt>
                    <dd class="govuk-summary-list__value"><a class="govuk-link govuk-link--no-visited-state" href="#">www.{{_providerTitle|lower|replace(" ", "")|replace(".", "")}}.co.uk</a></dd>
                </div>
            </dl>
            {% endif %}

            {% else %}
            <form action="provider" method="GET" class="govuk-!-width-three-quarters" >
                <div class="search-wrapper govuk-form-group search-wrapper-das search-wrapper-das-small" >
                    <legend style="display:none">[Enter your location]</legend>
                    <label for="search-location" class="govuk-label" >
                        Enter your location to check if this provider offers training for this course
                        <!-- <span class="govuk-!-font-weight-bold ">Location</span> -->
                    </label>
                    <!-- <span class="govuk-hint">
                        Postcode, town or city
                    </span> -->
                    <div class="search-input-wrapper">
                        <input type="search" value="{% if myData.locationapplied == true %}{{myData.location}}{% endif %}" id="search-location" name="location" title="Search" class="govuk-input ">
                        <div class="search-input-submit-wrapper">
                            <button type="submit" class="search-submit" id="search-location-submit">Enter location</button>
                        </div>
                    </div>
                </div>
                <input type="hidden" value="{{_selectedStandardlarsCode}}" name="standard" >
                <input type="hidden" value="{{_selectedProvider.id}}" name="provider" >
            </form>
            {% endif %}

            


            

            <!-- <dl class="govuk-summary-list">
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">Email</dt>
                    <dd class="govuk-summary-list__value"><a class="govuk-link govuk-link--no-visited-state" href="#">contact@{{_providerTitle|lower|replace(" ", "")|replace(".", "")}}.co.uk</a></dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">Telephone</dt>
                    <dd class="govuk-summary-list__value">078&nbsp;7856&nbsp;9856</dd>
                </div>
                <div class="govuk-summary-list__row">
                    <dt class="govuk-summary-list__key">Website</dt>
                    <dd class="govuk-summary-list__value"><a class="govuk-link govuk-link--no-visited-state" href="#">www.{{_providerTitle|lower|replace(" ", "")|replace(".", "")}}.co.uk</a></dd>
                </div>
            </dl> -->

            <!-- <hr> -->

            <!-- <p class="govuk-body">Find out if {{_providerTitle | safe}} can train an apprentice in your location.</p> -->
            
            <!-- <p>If natonal always yes, <br>else, yes/no if location known, <br>else add location to find out</p> -->

            <!-- <p class="govuk-body">{{_providerTitle | safe}} offers training for {{_standardTitle | safe}} in specific locations.</p> -->

        </div>

        <dl class="govuk-summary-list">
            <!-- <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Ofsted rating</dt>
                <dd class="govuk-summary-list__value">
                    {% if _selectedProvider.ofsted == 0 %}
                    <strong class="govuk-tag govuk-tag--grey">Not yet rated</strong>
                    {% elif _selectedProvider.ofsted == 1 %}
                    <strong class="govuk-tag govuk-tag--turquoise">Outstanding</strong>
                    {% elif _selectedProvider.ofsted == 2 %}
                    <strong class="govuk-tag govuk-tag--green">Good</strong>
                    {% elif _selectedProvider.ofsted == 3 %}
                    <strong class="govuk-tag govuk-tag--yellow">Requires improvement</strong>
                    {% elif _selectedProvider.ofsted == 4 %}
                    <strong class="govuk-tag govuk-tag--red">Inadequate</strong>
                    {% endif %}
                </dd>
            </div> -->
            <!-- <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Coverage</dt>
                <dd class="govuk-summary-list__value">{% if _selectedProvider.national == true %}National{% else %}Specific locations{% endif %}</dd>
            </div> -->
            
        <!-- </dl>

        <h2 class="govuk-heading-m">Contact details</h2>
        <dl class="govuk-summary-list"> -->
            <!-- <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Email</dt>
                <dd class="govuk-summary-list__value"><a class="govuk-link govuk-link--no-visited-state" href="#">contact@{{_providerTitle|lower|replace(" ", "")|replace(".", "")}}.co.uk</a></dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Telephone</dt>
                <dd class="govuk-summary-list__value">078&nbsp;7856&nbsp;9856</dd>
            </div>
            <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">Website</dt>
                <dd class="govuk-summary-list__value"><a class="govuk-link govuk-link--no-visited-state" href="#">www.{{_providerTitle|lower|replace(" ", "")|replace(".", "")}}.co.uk</a></dd>
            </div> -->

            <!-- <div class="govuk-summary-list__row">
                <dt class="govuk-summary-list__key">About</dt>
                <dd class="govuk-summary-list__value">
                    <details class="govuk-details govuk-!-margin-top-1" data-module="govuk-details">
                        <summary class="govuk-details__summary">
                            <span class="govuk-details__summary-text">
                            About {{_providerTitle | safe}}
                            </span>
                        </summary>
                        <div class="govuk-details__text">
                            <p class="govuk-body">{{_providerTitle | safe}} is a specialist private training company which has been delivering apprenticeships for 20 years. From our Midlands base, we work nationally to support private, public and third sector organisations - large and small - to develop their apprentices and achieve the best possible outcomes and value for both apprentice and employer.</p>
                            <p class="govuk-body">We specialise in:</p>
                            <ul class="govuk-list govuk-list--bullet">
                                <li>Learning and Development</li>
                                <li>Human Resources</li>
                                <li>Butchery & Food</li>
                                <li>Aviation</li>
                            </ul>
                            <p class="govuk-body">Our programmes are designed to fit the needs of employer and apprentice and are delivered in the workplace and/or at our specialist facilities. To make the apprenticeship special we pride ourselves on giving unique opportunities such as educational visits and outdoor residentials.</p>
                        </div>
                    </details>
                </dd>
            </div> -->

        </dl>


        



        <h2 class="govuk-heading-m govuk-!-margin-top">All courses offered ({{myData.displayCount}})</h2>

        {% for _standard in myData.standards.list %}
            {% if _standard.matchesProvider %}
            <div class=" govuk-!-margin-bottom-3" data-list-item data-search-data="{{_standardData|dump}}" >
                <p class="govuk-body govuk-!-margin-bottom-2">
                    <a href="provider?standard={{_standard.larsCode}}&provider={{_selectedProvider.id}}&location={{_defaultLocationSearchvalue}}" class="govuk-link govuk-link--no-visited-state">{{_standard.title}} (level&nbsp;{{_standard.level}})</a>
                </p>
                <ul class="govuk-list govuk-!-margin-bottom-2">
                    <li class="govuk-!-font-size-16"><span class="govuk-secondary-colour">Achievement rate:</span> 68%
                        <br><span class="govuk-secondary-colour">National average is 59%</span>
                    </li>
                </ul>
            </div>
            <hr class="govuk-section-break govuk-section-break--visible govuk-!-margin-bottom-2">
            {% endif %}
        {% endfor %}

        <!-- <br><br><br><br><br><br> -->

        <!-- <h2 class="govuk-heading-m">Provider</h2> -->
        <ol class="govuk-list govuk-list--number" style="color:red; display: none;">
            <li style="text-decoration: line-through">Provider name</li>
            <!-- <li>Trading name (if exist)</li> -->
            <!-- <li>UKPRN</li> -->
            <li style="text-decoration: line-through">Ofsted rating</li>
            <li style="text-decoration: line-through">National / Not national</li>
            <li style="text-decoration: line-through">Contact details (what are these/where are these)</li>
            <li style="text-decoration: line-through">About provider (free text)</li>
            <li>Employer reviews data</li>
            <li>Courses offered (list)</li>
            <li style="list-style: none;">
                <h2 class="govuk-heading-m govuk-!-margin-top-6">per each Course</h2>
                <ol class="govuk-list govuk-list--number">
                    <li>Achievement rate (based on SSA tier 2)</li>
                    <li>About apprenticeship (free text)</li>
                    <li>Contact details (website / email / phone / contact us webpage)</li>
                    <!-- <li style="list-style: none;">
                        <h2 class="govuk-heading-m govuk-!-margin-top-6">per each Location</h2>
                        <ol class="govuk-list govuk-list--number">
                            <li>Delivery modes</li>
                            <li>venue name</li>
                            <li>venue address</li>
                            <li>venue contact details (phone, email, website)</li>
                            <li>Distance from employer (if employer location known)</li>
                        </ol>
                    </li> -->
                </ol>
            </li>
        </ol>

        <!-- <div class="govuk-inset-text">
            <h3 class="govuk-heading-s govuk-!-margin-bottom-1">Email</h3>
            <p class="govuk-body"><a class="govuk-link govuk-link--no-visited-state" href="#">contact@{{_providerTitle|lower|replace(" ", "")|replace(".", "")}}.co.uk</a></p>
            <h3 class="govuk-heading-s govuk-!-margin-bottom-1">Telephone</h3>
            <p class="govuk-body">078&nbsp;7856&nbsp;9856</p>
            <h3 class="govuk-heading-s govuk-!-margin-bottom-1">URL</h3>
            <p class="govuk-body"><a class="govuk-link govuk-link--no-visited-state" href="#">www.{{_providerTitle|lower|replace(" ", "")|replace(".", "")}}.co.uk</a></p>
            <h3 class="govuk-heading-s govuk-!-margin-bottom-1">Address</h3>
            <p class="govuk-body">
                {{_selectedProvider.address.line1}}<br>
                {{_selectedProvider.address.city}}<br>
                {{_selectedProvider.address.postcode}}
            </p>
        </div> -->

        
        <!-- <ul class="govuk-list govuk-list--bullet" style="color: red">
            <li>minimum number of apprenticeships</li>
        </ul><hr> -->

    </div>
    <div class="govuk-grid-column-one-third">
       &nbsp;
    </div>
</div>

{% endblock %}


{% block pageScripts %}
<script>
    // Locations 
    function suggestLocations(query, populateResults) {
        var _allSuggestions = []

        // Cities
        var _citiesResults = {{_citiesAutocompleteList | dump | safe }},
            _filteredCitiesResults = _citiesResults.filter(
                result => result.toUpperCase().startsWith(query.trim().toUpperCase())
            )
        _filteredCitiesResults.sort(function(a,b){
            var returnValue = 0;
            if (a.toUpperCase() < b.toUpperCase()){
                returnValue = -1
            } else if(a.toUpperCase() > b.toUpperCase()){
                returnValue = 1
            }
            return returnValue
        });

        // Postcodes
        $.getJSON('https://api.postcodes.io/postcodes/' + query + '/autocomplete', function(body){
            var _postcodes = body.result || []
            _allSuggestions = _allSuggestions.concat(_filteredCitiesResults,_postcodes)
            populateResults(_allSuggestions)
        })
    }
    function fireLocationSearch(){setTimeout(function(){ $("#search-location-submit").trigger("click") },200);}
    var locationInput = document.querySelector('#search-location')
    if (locationInput) {
        var locationInputID = locationInput.id,
            locationElement = document.createElement('div'),
            defaultLocationSearchvalue = {{_defaultLocationSearchvalue | dump | safe }}
        locationElement.className = "autocomplete__parent_wrapper";
        locationInput.parentNode.insertBefore(locationElement, locationInput)
        accessibleAutocomplete({
            // other options
            element: locationElement,
            id: locationInputID,
            name: locationInput.name,
            source: suggestLocations,
            defaultValue: defaultLocationSearchvalue,
            minLength: 1,
            confirmOnBlur: false,
            autoselect: true,
            onConfirm: fireLocationSearch,
            displayMenu: 'overlay'
        })
        locationInput.style.display = 'none'
        locationInput.id = locationInputID + '-old'
        locationInput.name = ''
    }
</script>

{% endblock pageScripts %}